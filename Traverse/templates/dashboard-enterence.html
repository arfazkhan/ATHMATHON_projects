{% extends 'Dashboardbase.html' %} {% load static %} {% block content %}

<div bgcolor="red" align="center">
  <div class="row gap-3">
    {% include 'dashboard/suggetion_card.html' %}
  </div>
  <hr width="30%" />
  {% if user.is_authenticated %}
  {% endif %}
  <div class="flex-grow-1" id="map" style="width: 100%; height: 300px; border-radius: 10px"></div>
</div>

<script>

    function getLocation() {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(showPosition);
    } else {
      console.log("Geolocation is not supported by this browser.");
    }
  }

  function showPosition(position) {
    $.ajax({
      url: 'dashboard/companion/location',
      type: 'POST',
      data: {
        'latitude': position.coords.latitude,
        'longitude': position.coords.longitude,
        'csrfmiddlewaretoken': '{{ csrf_token }}'
      },
      success: function (response) {
        initMap(position)
      }
    });
  }
  function initMap(position) {
    const myLoc = { lat: position.coords.latitude, lng: position.coords.longitude };
    const map = new google.maps.Map(document.getElementById("map"), {
      zoom: 10,
      center: myLoc,
    });
    const marker = new google.maps.Marker({
        position: { lat: myLoc.lat, lng: myLoc.lng },
        animation: google.maps.Animation.DROP,
        map: map,
        icon: {
          url: "/static/images/d_loc_pin2.png",
          scaledSize: new google.maps.Size(32, 32),
        },
      });
  }
  
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAxaPlVxe-HTnuBzPajIUoXQSxiqoMitLc&callback=getLocation"></script>
{% endblock %}
